<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MEGAGAME 2026</title>
    <style>
        * { margin: 0; padding: 0; }
        body {
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        #game {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            /* 3x integer scale: 307*3=921, 224*3=672 */
            width: 921px;
            height: 672px;
        }
        #loading {
            color: #00d4ff;
            font-family: monospace;
            font-size: 16px;
        }
        #controls {
            position: fixed;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            color: #555;
            font-family: monospace;
            font-size: 11px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loading">MEGAGAME 2026 — Loading...</div>
    <canvas id="game" style="display:none"></canvas>
    <div id="controls" style="display:none">
        Arrows/WASD: Move &nbsp;|&nbsp; Num5/Space: Jump &nbsp;|&nbsp; Num4: Shoot &nbsp;|&nbsp; Num6/Shift: Dash &nbsp;|&nbsp; Tab: Switch Character &nbsp;|&nbsp; Esc: Stage Select
    </div>

    <script type="module">
        import { Game } from './src/engine/game.js';
        import { GameplayState } from './src/states/gameplay.js';
        import { StageSelectState } from './src/states/stage-select.js';
        import { AssetLoader } from './src/assets/asset-loader.js';

        const loading = document.getElementById('loading');
        const canvas = document.getElementById('game');
        const controls = document.getElementById('controls');

        async function init() {
            try {
                loading.textContent = 'MEGAGAME 2026 — Loading stages...';
                const assets = new AssetLoader();

                // Load all stage assets
                await Promise.all([
                    assets.loadStage('highway'),
                    assets.loadStage('frozentown'),
                    assets.loadStage('aircraftcarrier'),
                    assets.loadStage('crystalmine'),
                ]);

                loading.textContent = 'MEGAGAME 2026 — Loading sprites...';
                // Load player spritesheet, effects, enemy sprites, and stage select assets
                await Promise.all([
                    assets.loadImage('playerSprite', './assets/XDefault.png'),
                    assets.loadImage('zeroSprite', './assets/zero.png'),
                    assets.loadImage('effectsSprite', './assets/effects.png'),
                    assets.loadImage('tankSprite', './assets/sigma_viral.png'),
                    assets.loadImage('mavericksSprite', './assets/mavericks.png'),
                    assets.loadImage('stageSelect', './assets/stage-select.png'),
                    assets.loadJSON('stageLocations', './assets/stage-locations.json'),
                ]);

                // Create game early so audio system is available for loading
                const game = new Game(canvas);

                // Load audio assets
                loading.textContent = 'MEGAGAME 2026 — Loading audio...';
                await game.audio.loadAll({
                    // Common SFX
                    jump:        './assets/sounds/common/jump.wav',
                    dash:        './assets/sounds/common/dash.wav',
                    land:        './assets/sounds/common/land.wav',
                    hurt:        './assets/sounds/common/hurt.wav',
                    die:         './assets/sounds/common/die.wav',
                    hit:         './assets/sounds/common/hit.wav',
                    explosion:   './assets/sounds/common/explosion.wav',
                    wallkick:    './assets/sounds/common/wallkick.wav',
                    wallslide:   './assets/sounds/common/wallslide.wav',
                    warpIn:      './assets/sounds/common/warpIn.ogg',
                    heal:        './assets/sounds/common/heal.wav',
                    chargeStart: './assets/sounds/mmx/chargeStart.ogg',
                    chargeLoop:  './assets/sounds/mmx/chargeLoop.ogg',
                    // X buster
                    buster:  './assets/sounds/mmx/buster.ogg',
                    buster2: './assets/sounds/mmx/buster2.ogg',
                    buster3: './assets/sounds/mmx/buster3.ogg',
                    buster4: './assets/sounds/mmx/buster4.ogg',
                    // Zero saber
                    saber1: './assets/sounds/zero/saber1.ogg',
                    saber2: './assets/sounds/zero/saber2.ogg',
                    saber3: './assets/sounds/zero/saber3.ogg',
                    // Boss
                    chillpBlizzard: './assets/sounds/sigma/chillpBlizzard.ogg',
                    chillpSlide:    './assets/sounds/sigma/chillpSlide.ogg',
                    maverickDie:    './assets/sounds/sigma/maverickDie.ogg',
                    // Music (loop points encoded in filenames)
                    highway:      './assets/music/highway.44,44.87,463.ogg',
                    frozentown:   './assets/music/frozentown.0.40,531.ogg',
                    crystalmine:  './assets/music/crystalmine.2,710.44,517.ogg',
                    bossroom:     './assets/music/bossroom.1,5.29,664.ogg',
                    win:          './assets/music/win.ogg',
                });

                // Start game with stage select screen
                loading.style.display = 'none';
                canvas.style.display = 'block';
                controls.style.display = 'block';

                const locations = assets.getJSON('stageLocations');
                game.setState(new StageSelectState(assets, locations));
                game.start();
            } catch (e) {
                loading.textContent = `Error: ${e.message}`;
                console.error(e);
            }
        }

        init();
    </script>
</body>
</html>
