<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MEGAGAME 2026</title>
    <style>
        * { margin: 0; padding: 0; }
        body {
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        #game {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            /* 3x integer scale: 256*3=768, 224*3=672 */
            width: 768px;
            height: 672px;
        }
        #loading {
            color: #00d4ff;
            font-family: monospace;
            font-size: 16px;
        }
        #controls {
            position: fixed;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            color: #555;
            font-family: monospace;
            font-size: 11px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loading">MEGAGAME 2026 — Loading...</div>
    <canvas id="game" style="display:none"></canvas>
    <div id="controls" style="display:none">
        Arrows/WASD: Move &nbsp;|&nbsp; Z/Space: Jump &nbsp;|&nbsp; X: Shoot &nbsp;|&nbsp; C/Shift: Dash &nbsp;|&nbsp; F1/F2: Stage Select
    </div>

    <script type="module">
        import { Game } from './src/engine/game.js';
        import { GameplayState } from './src/states/gameplay.js';
        import { AssetLoader } from './src/assets/asset-loader.js';

        const loading = document.getElementById('loading');
        const canvas = document.getElementById('game');
        const controls = document.getElementById('controls');

        async function init() {
            try {
                loading.textContent = 'MEGAGAME 2026 — Loading stages...';
                const assets = new AssetLoader();

                // Load all stage assets
                await Promise.all([
                    assets.loadStage('highway'),
                    assets.loadStage('frozentown'),
                ]);

                loading.textContent = 'MEGAGAME 2026 — Loading sprites...';
                // Load player spritesheet, effects, and enemy sprites
                await Promise.all([
                    assets.loadImage('playerSprite', './assets/XDefault.png'),
                    assets.loadImage('effectsSprite', './assets/effects.png'),
                    assets.loadImage('tankSprite', './assets/sigma_viral.png'),
                    assets.loadImage('mavericksSprite', './assets/mavericks.png'),
                ]);

                // Start game with highway
                loading.style.display = 'none';
                canvas.style.display = 'block';
                controls.style.display = 'block';

                const stages = ['highway', 'frozentown'];
                let currentStageIdx = 0;

                const game = new Game(canvas);
                game.setState(new GameplayState(assets, stages[currentStageIdx]));
                game.start();

                // Stage switching with F1/F2
                window.addEventListener('keydown', (e) => {
                    let newIdx = -1;
                    if (e.code === 'F1') newIdx = 0;
                    if (e.code === 'F2') newIdx = 1;
                    if (newIdx >= 0 && newIdx !== currentStageIdx) {
                        e.preventDefault();
                        currentStageIdx = newIdx;
                        game.setState(new GameplayState(assets, stages[currentStageIdx]));
                    }
                });
            } catch (e) {
                loading.textContent = `Error: ${e.message}`;
                console.error(e);
            }
        }

        init();
    </script>
</body>
</html>
